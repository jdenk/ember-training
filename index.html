<!DOCTYPE HTML>

<html>
  <head>
    <meta charset='utf-8'>
    <title>BümBöx</title>
    <link rel="stylesheet" href="css/app.css">

    <script src="js/libs/handlebars-1.0.rc.2.js"></script>
    <script src="js/libs/jquery-1.8.3.js"></script>
    <script src="js/libs/ember.js"></script>
    <script src="js/libs/ember-data.js"></script>
    <script src="js/app.js"></script>

    <script src="tests/load-tests.js"></script>
  </head>
  <body>
    <script type="text/x-handlebars">
        <header>
            {{#linkTo "index"}}
                <h1>BumBox</h1>
            {{/linkTo}}
        </header>
        {{outlet}}

        {{render "nowPlaying"}}
    </script>

    <script data-template-name="audioControl" type="text/x-handlebars">
        <audio autoplay {{bindAttr src="view.src"}}></audio>

        {{#if view.isPlaying}}
            <button class="pause" {{action "pause" target="view"}}>❚❚</button>
        {{else}}
            <button class="play" {{action "play" target="view"}}>▶</button>
        {{/if}}

        <p class="duration">
            <span {{action "toggleTime" target="view"}}>
            {{#if view.displayRemaining}}
                -{{format-duration view.remainingTime}}
            {{else}}
                {{format-duration view.currentTime}}
            {{/if}}
            </span>

            <input type="range" {{bindAttr value="view.currentTime"}} {{bindAttr max="view.duration"}}></input>
        </p>

    </script>

    <script data-template-name="nowPlaying" type="text/x-handlebars">
      {{#if displayQueue}}
        <div id="queue">
            <table class="show-queue album-listing">
              {{#each nextSongs itemController="song"}}
                {{partial songRow}}
              {{/each}}
            </table>
        </div>
      {{/if}}

        <footer class="now-playing">
        {{#if model}}
            <img class="now-playing-artwork" {{bindAttr src="album.artwork"}}>
            <div class="now-playing-body">
              <p class="now-playing-details">
                <span class="now-playing-name">{{name}}</span> -
                <span class="now-playing-artist">{{album.artist}}</span>
              </p>
              <div class="now-playing-player">
                {{view App.AudioView srcBinding="url"}}
              </div>
            </div>
        {{else}}
          <span class="now-playing-empty">Select a song to start playing.</span>
        {{/if}}

        {{#if nextSongs}}
            <p class="queue">
                {{nextSongs.length}}
                <button class="next" {{action "next"}}>&gt;</button>
            </p>
        {{/if}}

            <button class="queue" {{action "showQueue"}}>Show queue</button>
        </footer>
    </script>

    <script data-template-name="index" type="text/x-handlebars">
        <div class="album-list">
          {{#each album in controller}}
              <div class="album">
                {{#linkTo "album" album}}
                    <img {{bindAttr src="album.artwork"}}>
                {{/linkTo}}
                <p class="album-name">{{album.name}}</p>
                <p class="album-artist">{{album.artist}}</p>
                <p class="song-count">
                  {{album.songs.length}} songs
                  {{#if album.isExplicit}}
                      <span class="explicit">EXPLICIT</span>
                  {{/if}}
                </p>
              </div>
          {{/each}}
        </div>
    </script>

    <script data-template-name="_songRow" type="text/x-handlebars">
          <tr {{bindAttr class="isSelected:is-playing"}}>
            <td class="song-track">
              <span class="track-number">{{track}}</span>
              <span class="play" {{action "play" this}}>▶</span>
              <button class="queue" {{action "enqueue" this}}>Queue</button>
            </td>
            <td class="song-name">{{name}}</td>
            <td class="song-duration">{{format-duration duration}}</td>
          </tr>
    </script>

    <script data-template-name="album" type="text/x-handlebars">
        <div class="album-info">
          <img {{bindAttr src="artwork"}}">
          <h1>{{unbound name}}</h1>
          <h2>{{unbound artist}}</h2>
        </div>
        <table class="album-listing">
          {{#each songs itemController="song"}}
            {{partial songRow}}
          {{/each}}
          <tr>
            <td class="total-duration" colspan="3">Total Time: {{format-duration totalDuration}}</td>
          </tr>
        </table>
    </script>

    <div id="qunit" style="display: none"></div>
    <div id="qunit-fixture" style="display: none"></div>
  </body>
</html>
